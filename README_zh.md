[English](./README.md)

# Memos Worker: ç”± Cloudflare é©±åŠ¨çš„ç¬”è®°ä¸çŸ¥è¯†åº“

![1](./image/1.png)
![1](./image/2.png)
![1](./image/3.png)
![1](./image/4.png)

**Memos Worker** æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ€§èƒ½å“è¶Šçš„æ— æœåŠ¡å™¨ç¬”è®°å’ŒçŸ¥è¯†åº“åº”ç”¨ã€‚å®ƒå®Œå…¨æ„å»ºåœ¨ Cloudflare çš„ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šï¼ˆWorkers, Pages, D1, R2, KVï¼‰ï¼Œä¸ºä½ æä¾›ä¸€ä¸ªå¯ä»¥æ°¸ä¹…æ‹¥æœ‰ã€è¿‘ä¹é›¶æˆæœ¬çš„ç§æœ‰åŒ–ç¬”è®°è§£å†³æ–¹æ¡ˆã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

-   **âœï¸ Markdown å…¨åŠŸèƒ½æ”¯æŒ**: æ”¯æŒå®æ—¶é¢„è§ˆã€åˆ†æ ç¼–è¾‘ï¼Œå¹¶èƒ½ä»å¯Œæ–‡æœ¬æ™ºèƒ½ç²˜è´´ä¸º Markdownã€‚
-   **ğŸ—‚ï¸ æ–‡ä»¶ä¸é™„ä»¶**: æ”¯æŒæ‹–æ‹½æˆ–ç²˜è´´ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯å­˜è‡³ R2 æˆ– Imgurï¼‰åŠå„ç±»æ–‡ä»¶é™„ä»¶ã€‚
-   **ğŸ”— å…¬å¼€åˆ†äº«**: å¯ä»¥ä¸ºç¬”è®°ä¸­çš„æ–‡ä»¶ç”Ÿæˆå”¯ä¸€çš„å…¬å¼€è®¿é—®é“¾æ¥ã€‚
-   **ğŸ¤– Telegram é›†æˆ**: é€šè¿‡ Telegram Bot éšæ—¶éšåœ°è®°å½•æ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘å’Œæ–‡ä»¶ã€‚
-   **ğŸ“š å¼ºå¤§ç»„ç»‡èƒ½åŠ›**: è‡ªåŠ¨æ ‡ç­¾ã€å…¨æ–‡æœç´¢ã€æ—¶é—´çº¿ã€æ—¥å†å’Œæ´»åŠ¨çƒ­åŠ›å›¾ã€‚
-   **ğŸ“ƒ çŸ¥è¯†åº“ (Docs)**: ç‹¬ç«‹çš„æ ‘çŠ¶æ–‡æ¡£ä¸­å¿ƒï¼Œé€‚åˆæ„å»ºç»“æ„åŒ–çš„çŸ¥è¯†ä½“ç³»ã€‚
-   **ğŸ¨ é«˜åº¦å¯å®šåˆ¶**: æ”¯æŒæµ…è‰²/æ·±è‰²ä¸»é¢˜ã€è‡ªå®šä¹‰ä¸»è‰²è°ƒã€èƒŒæ™¯å›¾ç‰‡ã€ç»ç’ƒæ¨¡ç³Šæ•ˆæœåŠå¸ƒå±€è°ƒæ•´ã€‚
-   **ğŸš€ æè‡´æ€§èƒ½ä¸ä½æˆæœ¬**: åŸºäº Cloudflare å…¨çƒç½‘ç»œï¼Œå“åº”è¿…é€Ÿï¼Œåœ¨å…è´¹å¥—é¤é¢åº¦å†…å‡ ä¹é›¶æˆæœ¬è¿è¡Œã€‚
-   **ğŸ” æ•°æ®è‡ªä¸»**: æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨ä½ è‡ªå·±çš„ Cloudflare è´¦æˆ·ä¸­ã€‚

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç¬¬ 1 æ­¥: Forkæœ¬é¡¹ç›®å¹¶åˆ›å»º Cloudflare èµ„æº

1.  **Fork æœ¬é¡¹ç›®**åˆ°ä½ è‡ªå·±çš„ GitHub è´¦æˆ·ã€‚
2. åˆ›å»º Cloudflare èµ„æº

ä½ éœ€è¦åœ¨ Cloudflare Dashboard ä¸­æ‰‹åŠ¨åˆ›å»ºå¥½é¡¹ç›®æ‰€éœ€çš„ D1 æ•°æ®åº“ã€R2 å­˜å‚¨æ¡¶å’Œ KV å‘½åç©ºé—´ã€‚

| èµ„æºç±»å‹        | æ¨èåç§°          | ç»‘å®šå˜é‡å        |
| --------------- | ----------------- | ----------------- |
| **D1 æ•°æ®åº“**   | `notes-db`        | `DB`              |
| **KV å‘½åç©ºé—´** | `notes-kv`        | `NOTES_KV`        |
| **R2 å­˜å‚¨æ¡¶**   | `notes-r2-bucket` | `NOTES_R2_BUCKET` |

1.  **åˆ›å»º D1 æ•°æ®åº“ (`notes-db`)**:
	-   è¿›å…¥ **Workers & Pages** -> **D1** -> **Create database**ã€‚
	-   **é‡è¦**: åˆ›å»ºåï¼Œè¿›å…¥æ•°æ®åº“æ§åˆ¶å°ï¼Œå°†é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `schema.sql` æ–‡ä»¶å†…å®¹å®Œæ•´å¤åˆ¶è¿›å»å¹¶æ‰§è¡Œã€‚
    - **é‡è¦**: è®°ä¸‹database_idå’Œdatabase_nameï¼Œå†™å…¥ `wrangler.toml` æ–‡ä»¶D1éƒ¨åˆ†ã€‚

2.  **åˆ›å»º KV å‘½åç©ºé—´ (`notes-kv`)**:
	-   è¿›å…¥ **Workers & Pages** -> **KV** -> **Create a namespace**ã€‚
    - **é‡è¦**: è®°ä¸‹idï¼Œå†™å…¥ `wrangler.toml` æ–‡ä»¶KVéƒ¨åˆ†ã€‚

3.  **åˆ›å»º R2 å­˜å‚¨æ¡¶ (`notes-r2-bucket`)**:
	-   è¿›å…¥ **R2** -> **Create bucket**ã€‚
    - **é‡è¦**: è®°ä¸‹bucket_nameï¼Œå†™å…¥ `wrangler.toml` æ–‡ä»¶R2éƒ¨åˆ†ã€‚

### ç¬¬ 2 æ­¥: éƒ¨ç½²åˆ° Cloudflare Workers

1.  è¿›å…¥ Cloudflare Dashboard -> **Workers & Pages** -> **Create application** -> **é€‰æ‹©Workers** -> **è¿æ¥åˆšæ‰åˆ›å»ºçš„Gitåº“**ã€‚
2.  é€‰æ‹©ä½  Fork çš„ä»“åº“ï¼Œç„¶åç›´æ¥ç‚¹å‡» **Save and Deploy**ã€‚

### ç¬¬ 3 æ­¥: é…ç½®ç¯å¢ƒå˜é‡

éƒ¨ç½²å®Œæˆåï¼Œè¿›å…¥ä½ åˆ›å»ºçš„ Worker é¡¹ç›®è¿›è¡Œé…ç½®ã€‚

1.  è¿›å…¥é¡¹ç›® -> **Settings**ï¼Œè¿›å…¥ **Environment Variables**ï¼Œæ·»åŠ ä»¥ä¸‹å˜é‡ï¼š

	| Variable Name           | Description                          |
    | ----------------------- | ------------------------------------ |
	| `USERNAME`              | ä½ çš„ç™»å½•ç”¨æˆ·å                       |
	| `PASSWORD`              | ä½ çš„ç™»å½•å¯†ç                          |
	| `TELEGRAM_BOT_TOKEN`    | (å¯é€‰) Telegram æœºå™¨äººçš„ Token       |
	| `TELEGRAM_WEBHOOK_SECRET` | (å¯é€‰) ä¸€ä¸ªéšæœºé•¿å­—ç¬¦ä¸²ç”¨äº Webhook éªŒè¯ |
	| `AUTHORIZED_TELEGRAM_IDS` | (å¯é€‰) æˆæƒä½¿ç”¨æœºå™¨äººçš„ Telegram ç”¨æˆ· ID |

2.  é‡æ–°éƒ¨ç½²ï¼Œè®©æ‰€æœ‰é…ç½®ç”Ÿæ•ˆã€‚

## ğŸ”§ é¡¹ç›®å¼€å‘ (Wrangler)

### 1. æœ¬åœ°å¼€å‘ (æ¨¡æ‹Ÿç¯å¢ƒ)

**åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“**:
```bash
npx wrangler d1 execute memos-db --local --file=./schema.sql
```

**å¯åŠ¨å¼€å‘æœåŠ¡å™¨**:
```bash
npx wrangler dev
```

### 2. æœ¬åœ°å¼€å‘ (è¿æ¥äº‘ç«¯çœŸå®èµ„æº)

æ­¤æ¨¡å¼è¿æ¥åˆ°ä½ åœ¨ Cloudflare ä¸Šåˆ›å»ºçš„çœŸå®èµ„æºï¼Œé€‚åˆè°ƒè¯•æ•°æ®é€»è¾‘ã€‚

1.  **é…ç½® `wrangler.toml`**: å°†ä½ åœ¨ Cloudflare Dashboard ä¸­åˆ›å»ºçš„èµ„æº ID å¡«å…¥æ­¤æ–‡ä»¶ã€‚
	```toml
	# wrangler.toml
	[[d1_databases]]
	binding = "DB"
	database_name = "notes-db"
	database_id = "YOUR_D1_DATABASE_ID" # æ›¿æ¢

	[[kv_namespaces]]
	binding = "NOTES_KV"
	id = "YOUR_KV_NAMESPACE_ID" # æ›¿æ¢

	[[r2_buckets]]
	binding = "NOTES_R2_BUCKET"
	bucket_name = "notes-r2-bucket"
	```
2.  **åˆ›å»º `.dev.vars` æ–‡ä»¶**: åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ­¤æ–‡ä»¶å¹¶å¡«å…¥ä½ çš„å¯†é’¥ã€‚
	```ini
	# .dev.vars (æ­¤æ–‡ä»¶ä¸ä¼šè¢«æäº¤åˆ° Git)
	USERNAME="dev_user"
	PASSWORD="dev_password"
	```
3.  **å¯åŠ¨è¿œç¨‹å¼€å‘æœåŠ¡å™¨**:
	```bash
	npx wrangler dev --remote
	```
